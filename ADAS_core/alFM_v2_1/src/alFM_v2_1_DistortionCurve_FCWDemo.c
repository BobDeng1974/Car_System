
#include "mtype.h"
#include "alFM_v2_1_Def.h"

/** \cond DOXYGEN_EXCLUDE */

#define alFM_v2_1_DISTORTION_CURVE_LENGTH    101

static UINT32    g_alFM_v2_1_ulImageWidth = 1280;
static UINT32    g_alFM_v2_1_ulImageHeight = 800;
static UINT16    g_alFM_v2_1_uwCODX = 640;
static UINT16    g_alFM_v2_1_uwCODY = 400;

static UINT32    g_alFM_v2_1_ulSensorPixelWidth_FCWDemo = 1280;   // in pixel
static UINT32    g_alFM_v2_1_ulSensorPixelHeight_FCWDemo = 800;   // in pixel
static UINT32    g_alFM_v2_1_ulSensorPixelSize_FCWDemo = 4200;    // in nm

static FLOAT64   g_alFM_v2_1_eFOV_V_FCWDemo = 55.179364;          // in degree
static FLOAT64   g_alFM_v2_1_eFOV_H_FCWDemo = 91.272349;          // in degree
static FLOAT64   g_alFM_v2_1_eUD_FOV_H_FCWDemo = 74.311659;       // in degree, for 2D 反魚眼使用
static FLOAT64   g_alFM_v2_1_eFocalLength_FCWDemo = 3.54706769;   // in mm

static FLOAT64   g_alFM_v2_1_eHResizeRatio_FCWDemo = 1.0;         

static UINT32    g_alFM_v2_1_ulAngleTableScale_FCWDemo = 1;
static UINT32    g_alFM_v2_1_ulCurveLength_FCWDemo = alFM_v2_1_DISTORTION_CURVE_LENGTH;

static FLOAT64 g_alFM_v2_1_aeAngleDegree_FCWDemo[alFM_v2_1_DISTORTION_CURVE_LENGTH] = 
{
    0, 0.55396734, 1.10793469, 1.66190203, 2.21586937, 2.76983672, 3.32380406, 3.8777714, 4.43173875, 4.98570609,
    5.53967343, 6.09364078, 6.64760812, 7.20157546, 7.7555428, 8.30951015, 8.86347749, 9.41744483, 9.97141218, 10.52537952,
    11.07934686, 11.63331421, 12.18728155, 12.74124889, 13.29521624, 13.84918358, 14.40315092, 14.95711827, 15.51108561, 16.06505295,
    16.6190203, 17.17298764, 17.72695498, 18.28092233, 18.83488967, 19.38885701, 19.94282436, 20.4967917, 21.05075904, 21.60472638,
    22.15869373, 22.71266107, 23.26662841, 23.82059576, 24.3745631, 24.92853044, 25.48249779, 26.03646513, 26.59043247, 27.14439982,
    27.69836716, 28.2523345, 28.80630185, 29.36026919, 29.91423653, 30.46820388, 31.02217122, 31.57613856, 32.13010591, 32.68407325,
    33.23804059, 33.79200794, 34.34597528, 34.89994262, 35.45390996, 36.00787731, 36.56184465, 37.11581199, 37.66977934, 38.22374668,
    38.77771402, 39.33168137, 39.88564871, 40.43961605, 40.9935834, 41.54755074, 42.10151808, 42.65548543, 43.20945277, 43.76342011,
    44.31738746, 44.8713548, 45.42532214, 45.97928949, 46.53325683, 47.08722417, 47.64119151, 48.19515886, 48.7491262, 49.30309354,
    49.85706089, 50.41102823, 50.96499557, 51.51896292, 52.07293026, 52.6268976, 53.18086495, 53.73483229, 54.28879963, 54.84276698,
    55.39673432,
};

static FLOAT64 g_alFM_v2_1_aeRealHeight_FCWDemo[alFM_v2_1_DISTORTION_CURVE_LENGTH] = 
{
    0,	0.03429365,	0.06858601,	0.10287578,	0.13716168,	0.17144241,	0.20571667,	0.23998317,	0.27424059,	0.30848764,
    0.342723,	0.37694536,	0.4111534,	0.44534579,	0.47952119,	0.51367827,	0.54781568,	0.58193207,	0.61602605,	0.65009628,
    0.68414135,	0.71815988,	0.75215047,	0.78611168,	0.82004211,	0.85394031,	0.88780482,	0.92163418,	0.95542691,	0.98918151,
    1.02289648,	1.05657028,	1.09020138,	1.12378822,	1.15732922,	1.19082279,	1.22426732,	1.25766118,	1.29100271,	1.32429026,
    1.35752213,	1.39069661,	1.42381197,	1.45686646,	1.4898583,	1.5227857,	1.55564684,	1.58843987,	1.62116292,	1.6538141,
    1.6863915,	1.71889317,	1.75131715,	1.78366143,	1.81592401,	1.84810282,	1.88019581,	1.91220086,	1.94411584,	1.9759386,
    2.00766695,	2.03929868,	2.07083153,	2.10226324,	2.13359151,	2.16481399,	2.19592833,	2.22693214,	2.25782298,	2.28859842,
    2.31925596,	2.34979309,	2.38020727,	2.41049593,	2.44065645,	2.47068621,	2.50058254,	2.53034275,	2.55996412,	2.58944388,
    2.61877926,	2.64796746,	2.67700562,	2.70589089,	2.73462036,	2.76319113,	2.79160023,	2.81984471,	2.84792156,	2.87582776,
    2.90356026,	2.931116,	2.95849189,	2.98568481,	3.01269165,	3.03950924,	3.06613442,	3.09256401,	3.11879482,	3.14482362,
    3.17064721,
};

static FLOAT64 g_alFM_v2_1_aeRefHeight_FCWDemo[alFM_v2_1_DISTORTION_CURVE_LENGTH] = 
{
    0,	0.03429493,	0.06859628,	0.10291046,	0.13724389,	0.17160302,	0.20599432,	0.24042426,	0.27489936,	0.30942616,
    0.34401126,	0.37866129,	0.41338293,	0.4481829,	0.48306801,	0.51804512,	0.55312116,	0.58830313,	0.62359812,	0.65901332,
    0.69455598,	0.73023349,	0.76605332,	0.80202307,	0.83815044,	0.87444327,	0.91090954,	0.94755736,	0.98439499,	1.02143086,
    1.05867355,	1.09613182,	1.13381461,	1.17173105,	1.20989049,	1.24830248,	1.28697677,	1.32592338,	1.36515255,	1.40467477,
    1.44450084,	1.48464178,	1.52510895,	1.56591401,	1.60706891,	1.64858599,	1.69047791,	1.73275771,	1.77543881,	1.81853506,
    1.86206072,	1.90603049,	1.95045957,	1.99536361,	2.04075883,	2.08666194,	2.13309024,	2.18006164,	2.22759465,	2.27570847,
    2.32442296,	2.37375873,	2.42373714,	2.47438035,	2.52571139,	2.57775416,	2.6305335,	2.68407524,	2.73840625,	2.7935545,
    2.84954912,	2.90642046,	2.96420016,	3.02292121,	3.08261807,	3.14332672,	3.20508473,	3.2679314,	3.33190785,	3.39705711,
    3.46342424,	3.53105648,	3.60000337,	3.67031688,	3.74205161,	3.81526492,	3.8900171,	3.96637163,	4.04439532,	4.1241586,
    4.20573571,	4.28920503,	4.37464933,	4.46215609,	4.55181787,	4.64373267,	4.73800434,	4.83474303,	4.93406568,	5.03609655,
    5.14096782,
};

static FLOAT64 g_alFM_v2_1_aeDistortionCurve_FCWDemo[alFM_v2_1_DISTORTION_CURVE_LENGTH] = 
{
    0,	-0.00374355,	-0.01497435,	-0.03369286,	-0.05989988,	-0.09359647,	-0.13478399,	-0.18346423,	-0.23963917,	-0.30331112,
    -0.37448269,	-0.45315682,	-0.53933672,	-0.6330259,	-0.73422817,	-0.84294764,	-0.95918867,	-1.08295594,	-1.21425438,	-1.35308922,
    -1.49946594,	-1.65339029,	-1.81486827,	-1.98390614,	-2.16051041,	-2.34468783,	-2.53644538,	-2.73579028,	-2.94272994,	-3.15727201,
    -3.37942435,	-3.60919499,	-3.84659217,	-4.0916243,	-4.34429996,	-4.6046279,	-4.872617,	-5.14827631,	-5.43161499,	-5.72264231,
    -6.02136766,	-6.32780053,	-6.64195048,	-6.96382714,	-7.29344021,	-7.63079942,	-7.97591453,	-8.32879531,	-8.68945155,	-9.05789299,
    -9.43412936,	-9.81817035,	-10.21002555,	-10.6097045,	-11.01721663,	-11.43257125,	-11.85577751,	-12.28684445,	-12.72578088,	-13.17259546,
    -13.62729661,	-14.0898925,	-14.56039105,	-15.03879991,	-15.52512641,	-16.01937754,	-16.52155996,	-17.03167995,	-17.54974337,	-18.07575567,
    -18.60972184,	-19.15164641,	-19.70153337,	-20.25938621,	-20.82520786,	-21.39900065,	-21.9807663,	-22.57050589,	-23.16821983,	-23.77390785,
    -24.38756891,	-25.00920125,	-25.63880231,	-26.27636871,	-26.92189623,	-27.57537978,	-28.23681335,	-28.90619001,	-29.58350185,	-30.26873999,
    -30.96189449,	-31.6629544,	-32.37190766,	-33.08874111,	-33.81344046,	-34.54599022,	-35.28637377,	-36.03457321,	-36.79056943,	-37.55434205,
    -38.32586939,
};

void alFM_v2_1_LoadModedCfg_FCWDemo(alFM_v2_1_ModelCfg * a_ptFM_v2_Cfg)
{
    UINT16 uwDI;

    a_ptFM_v2_Cfg->ulImageWidth = g_alFM_v2_1_ulImageWidth;
    a_ptFM_v2_Cfg->ulImageHeight = g_alFM_v2_1_ulImageHeight;
    a_ptFM_v2_Cfg->uwCOD_X = g_alFM_v2_1_uwCODX;
    a_ptFM_v2_Cfg->uwCOD_Y = g_alFM_v2_1_uwCODY;

    a_ptFM_v2_Cfg->uwSrcSensorWidth = g_alFM_v2_1_ulSensorPixelWidth_FCWDemo;
    a_ptFM_v2_Cfg->ulSensorPixelSize = g_alFM_v2_1_ulSensorPixelSize_FCWDemo;
    a_ptFM_v2_Cfg->uwLengthOfDistortionCurve = g_alFM_v2_1_ulCurveLength_FCWDemo;
    a_ptFM_v2_Cfg->uwAngleTableScale = g_alFM_v2_1_ulAngleTableScale_FCWDemo;
    a_ptFM_v2_Cfg->eFocalLength = g_alFM_v2_1_eFocalLength_FCWDemo;
    a_ptFM_v2_Cfg->eFOV_H = g_alFM_v2_1_eFOV_H_FCWDemo;
    a_ptFM_v2_Cfg->eUD_FOV_H = g_alFM_v2_1_eUD_FOV_H_FCWDemo;
    a_ptFM_v2_Cfg->eHResizeRatio = g_alFM_v2_1_eHResizeRatio_FCWDemo;

    for(uwDI = 0; uwDI < g_alFM_v2_1_ulCurveLength_FCWDemo; uwDI++)
    {
        a_ptFM_v2_Cfg->aeAngleDegree[uwDI] = g_alFM_v2_1_aeAngleDegree_FCWDemo[uwDI];
        a_ptFM_v2_Cfg->aeRealHeight[uwDI] = g_alFM_v2_1_aeRealHeight_FCWDemo[uwDI];
#if 0
        a_ptFM_v2_Cfg->aeRefHeight[uwDI] = g_alFM_v2_1_aeRefHeight_FCWDemo[uwDI];
        a_ptFM_v2_Cfg->aeDistortion[uwDI] = g_alFM_v2_1_aeDistortionCurve_FCWDemo[uwDI];
#endif
    }
}

#undef alFM_v2_1_DISTORTION_CURVE_LENGTH

/** \endcond DOXYGEN_EXCLUDE */
